<!DOCTYPE html>
<html lang="en">
    <head>
        <title>班表操作</title>
        <!-- Bootstrap -->
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
     
        <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
        <link href="bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet" media="screen"> 
        <link href="vendors/easypiechart/jquery.easy-pie-chart.css" rel="stylesheet" media="screen">
        <link href="css/styles.css" rel="stylesheet" media="screen">
           <link rel="stylesheet" href="css/index.css">
           <link rel="stylesheet" href="css/Advisory.css">
           <link rel="stylesheet" href="css/polling.css">
       <script src="vendors/modernizr-2.6.2-respond-1.1.0.min.js"></script>
        <link rel="stylesheet" type="text/css" href="themes/default/easyui.css">
        <link rel="stylesheet" type="text/css" href="themes/icon.css">
        <script type="text/javascript" src="https://www.jeasyui.com/easyui/jquery.min.js"></script>
        <script type="text/javascript" src="https://www.jeasyui.com/easyui/jquery.easyui.min.js"></script>
        <script type="text/javascript" src="https://www.jeasyui.com/easyui/datagrid-filter.js"></script>
        <script type="text/javascript" src="https://www.jeasyui.com/easyui/datagrid-cellediting.js"></script>
        <link rel="stylesheet" href="css/table.css">
        <style>
            #polling-header-top {
                height: 30px;
                background: rgb(248,248,248);
            }
            #polling-header-top>p {
                line-height: 30px;
            }
            .im_table td{
                border: 1px solid rgb(204,204,204);
    text-align: center;
    width: 12.5%;
    height: 30px;
            }
        </style>
        <script src="My97DatePicker/My97DatePicker/WdatePicker.js"></script>
    </head>
    
    <body>
        <div class="container-fluid">
            <div class="row-fluid">
                <!-- block -->
                <div class="block">
                    <div class="span12" id="polling-header">
                        <div class=" span12 " id="polling-header-top" style="margin-left:0">
                            <p class="polling-headerp" style="background-image: url('img/up.svg');"><span></span>查询条件</p>
                        </div>
                        <div class=" span12 " id="polling-header-body" style="overflow:hidden;display: none;margin-left:0">
                            <form style="position:relative;" name="seaform" id ="seaform">
                                <div class="span6"><span>咨询师：</span><select name="group_name" id="">
                                    <!-- <option value="">请选择</option>  -->
                                    <option value="">请选择姓名</option>
                                    <option value="1">jiangshan-1</option>
                                    <option value="2">jiangshan-1</option>
                                    <option value="7">jiangsha-1</option>
                                    <option value="8">jiangsh-1</option>
                                    <option value="9">jiangs-1</option>
                                    <option value="3">jiangshan-2</option>
                                    <option value="4">jiangshan-3</option>
                                    <option value="5">jiangshan-4</option>
                                    <option value="6">jiangshan-5</option>   
                                </select></div>
                                <div class="span6"><span>条件：</span><select name="project" id="">
                                    <!-- <option value="">请选择</option>  -->
                                    <option value="退挽">退挽</option>
                                    <option value="退费">退费</option>
                                </select></div>
                                <div class="span6"><span>搜索：</span>
                                    <input type="text" class="search_input">
                                </div>
                                <div class="span6">
                                    <span>查询时间：</span><input class="Wdate" type="text" style="width:23%" onClick="WdatePicker({el:this,dateFmt:'yyyy-MM-dd HH:mm:ss'})" name="last_time1"  placeholder="日期">
                                    <span style="width:10%;text-align:center">至</span>
                                    <input class="Wdate" type="text" style="width:23%" onClick="WdatePicker({el:this,dateFmt:'yyyy-MM-dd HH:mm:ss'})" name="last_time2" placeholder="日期">
                                </div>
                                <input type="button" class="reset" value="重置" style="margin-right:30px"></input>
                                <input type="button" id="seasearch"  class="seasearch" value="查询"></input>
                               
                            </form>
                        </div>

                        <div class=" span12 " id="polling-header-footer" style="margin-left:0">
                                <div class="block-content collapse in" >
                                        <div class="span12">
                                              <div style="overflow:auto">
                                                <table id="datagrid2" title="领取数据列表" style="width:100%;height:400px"
                                                data-options="rownumbers:true,singleSelect:true,pagination:true,pageSize:10,pagelist:[10,20,30]">
                                            
                                                
                                                        <thead data-options="frozen:true">
                                                          <tr class="content">      
                                                    <!-- <th data-options="field:'ck',checkbox:true"></th> -->
                                                    <th data-options="field:'date_time',width:160,align:'center'">日期</th>
                                                    <th data-options="field:'user_name',width:160,align:'center',sortable:true,
                                                    sorter:function (a,b) {
                                                        return a.localeCompare(b);
                                                    }">姓名</th>
                                                    <th data-options="field:'group',width:160,align:'center'">组别</th> 
                                                        </tr></thead>
                                                        <thead>       
                                                    
                                                    <th data-options="field:'grade',width:160,align:'center',editor:{
                                                        type:'combobox',
                                                        options:{
                                                            valueField:'grade',
                                                            textField:'text',
                                                            panelHeight:'auto',
                                                            data:[{'text':'A','grade':'A'},{'text':'B','grade':'B'},{'text':'C','grade':'C'},{'text':'D','grade':'D'}]
                                                        }
                                                    }" >等级</th>
                                                    <th data-options="field:'max_num',width:160,align:'center' ,editor:'textbox'">上限</th>
                                                    <th data-options="field:'rate',width:160,align:'center'">效率值</th>
                                                    <th data-options="field:'alloc_num',width:160,align:'center'">当前分配数</th>
                                                    <th data-options="field:'work_type',width:160,align:'center',editor:{
                                                        type:'combobox',
                                                        options:{
                                                            valueField:'work_type',
                                                            textField:'text',
                                                            panelHeight:'auto',
                                                            data:[{'text':'白班','work_type':'白班'},{'text':'白加','work_type':'白加'},{'text':'请假','work_type':'请假'},{'text':'加班','work_type':'加班'}]
                                                        }
                                                    }">班次</th>
                                                    
                                                
                                                
                                            </thead>
                                        </table>

                                        </div>
                                        </div>
                                    </div>
                        </div>
                                
                    </div>
                </div>
            </div>
        </div>
        <div class="modelprompt1">
            <div class="modelcuer">
                <div class="modelcuer-head">
                    <p style="color:#42b983">提示</p>
                    <button class="promptx1">X</button>
                </div>
                <div class="modeldel-body">
                    <div class="monumber">
                        <p class="promptp1" style="color:#42b983;"></p>
                        <button class="promptx1" style="padding:0px 30px">确定</button>
                    </div>
                </div>
            </div>        
        </div>
        <div class="model-work-order" style="overflow:auto">
            <div class="modelorderr"style="top:10%" >
              <div class="modeldel-head">
                  <p style="color:#42b983">上传表格<span style="font-size:12px"></span></p>
                  <button class="work-orderx" style="">X</button>
              </div>
              <div class="modeldel-body">
                <div class="monumber"><span>表格：</span>
                  <input type="file" name="oldpwd" onchange="importf(this)" >
                  </div>
                  <div style="max-height:350px;overflow: auto">
                   <table class="im_table" style="    border-collapse: collapse;
                border: 1px solid rgb(204,204,204);
                width: 95%;
                margin: 0 auto;
                padding: 10px;">
                    <tr>
                        <td>姓名</td>
                        <td>账号</td>
                        <td>项目</td>
                        <td>班次</td>
                        <td>时间</td>
                        <td>uid</td>
                    </tr>
                </table>    
                  </div>
                
          <p class="revisep" style="color:#42b983;">hehe</p>
          
                <button style="padding:0px 30px" class="revisewen">提交</button>
            </div>
            </div>        
        
    </div>
    </body>
    <script src="js/xlcx.js"></script>
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <script src="js/export.js"></script>
    <script type="text/javascript" src="https://www.jeasyui.com/easyui/jquery.edatagrid.js"></script>
    <script type="text/javascript" src="https://www.jeasyui.com/easyui/datagrid-cellediting.js"></script>
    <script>
        var group_users=[{
        uid:1,
        user_name:'江山'
    },{
        uid:2,
        user_name:'江山2'
    },{
        uid:3,
        user_name:'江山3'
    }]
    var group_users1=[{
        uid:12,
        user_name:'江山2'
    },{
        uid:22,
        user_name:'江山22'
    },{
        uid:32,
        user_name:'江山32'
    }]
    data = group_users.concat(group_users1)
    console.log(data)
    function optnme(q){
            var arr1 = [];
            var arr2 = [];
            var objopt = {}
            for (let i = 0; i < q[0].length; i++) {
                arr1.push( q[0][i].value);
                arr2.push(q[0][i].innerHTML);
                
            }
           for (var j = 0; j < arr1.length; j++) {
               objopt[arr1[j]] = arr2[j]
               
           }
           return objopt
        }
    var objopt6
    function searchProject(){
        console.log($('select[name = project]').val())
        if($('select[name = project]').val() == '退挽'){
            $('select[name=group_name]')[0].innerHTML = ""
            for (let k = 0; k < group_users.length; k++) {
                $('select[name=group_name]')[0].innerHTML+=`
                    <option value="`+group_users[k].uid+`">`+group_users[k].user_name+`</option>
                `
            }
            objopt6 = optnme($('select[name=group_name]'))
            
        }else if($('select[name = project]').val() == '退费'){
            $('select[name=group_name]')[0].innerHTML = ""
            for (let k = 0; k < group_users1.length; k++) {
                $('select[name=group_name]')[0].innerHTML+=`
                    <option value="`+group_users1[k].uid+`">`+group_users1[k].user_name+`</option>
                `
            }
            objopt6 = optnme($('select[name=group_name]'))
        }
    }
    searchProject();
    $('select[name = project]').change(function(){
        searchProject()
    })
    console.log(data)
        $('.work-orderx').click(function(){
            $('.model-work-order').css('display','none')
        })
        /*
        FileReader共有4种读取方法：
        1.readAsArrayBuffer(file)：将文件读取为ArrayBuffer。
        2.readAsBinaryString(file)：将文件读取为二进制字符串
        3.readAsDataURL(file)：将文件读取为Data URL
        4.readAsText(file, [encoding])：将文件读取为文本，encoding缺省值为'UTF-8'
                     */
        var wb;//读取完成的数据
        var rABS = false; //是否将文件读取为二进制字符串
        var js ;var obja=[];
        function clearInputFile(f){
        if(f.value){
            try{
                f.value = ''; //for IE11, latest Chrome/Firefox/Opera...
            }catch(err){
            }
            if(f.value){ //for IE5 ~ IE10
                var form = document.createElement('form'), ref = f.nextSibling;
                form.appendChild(f);
                form.reset();
                ref.parentNode.insertBefore(f,ref);
            }
        }
    }

        function importf(obj) {//导入
            $('.im_table')[0].innerHTML=`
            <tr>
                        <td>姓名</td>
                        <td>账号</td>
                        <td>项目</td>
                        <td>班次</td>
                        <td>时间</td>
                        <td>uid</td>
                    </tr>
            `
            obja = [];
            if(!obj.files) {
                return;
            }
            var f = obj.files[0];
            var reader = new FileReader();
            reader.onload = function(e) {
                var data = e.target.result;
                if(rABS) {
                    wb = XLSX.read(btoa(fixdata(data)), {//手动转化
                        type: 'base64'
                    });
                } else {
                    wb = XLSX.read(data, {
                        type: 'binary'
                    });
                }
                //wb.SheetNames[0]是获取Sheets中第一个Sheet的名字
                //wb.Sheets[Sheet名]获取第一个Sheet的数据
                wb.Sheets[wb.SheetNames[0]].A1.w = "user_name";
                wb.Sheets[wb.SheetNames[0]].B1.w = "account";
                wb.Sheets[wb.SheetNames[0]].C1.w = "project";
                console.log(wb.Sheets[wb.SheetNames[0]]);
                js =  XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]])
                console.log(js);
                var ob = [];
                for (let i = 0; i < js.length; i++) {
                  for (var k in js[i]) {
                      if(k != 'user_name' && k != 'account' && k != 'project'){
                          var jsonc = {};
                          jsonc.user_name = js[i].user_name;
                          jsonc.project = js[i].project;
                          jsonc.account = js[i].account;
                          jsonc.time = k;
                          jsonc.class = js[i][k];
                            ob.push(jsonc)
                      }
                  }
                }
                console.log(ob)
                // return;
                js = ob;
                console.log(js)
data =group_users.concat(group_users1)
            for (let i = 0; i < js.length; i++) {
                obja[i]=[];
                obja[i].user_name = js[i].user_name;
                obja[i].project = js[i].project;
                obja[i].account = js[i].account;
                obja[i].class = js[i].class;
                obja[i].time = js[i].time;
                obja[i].uid = '0'
                // delete js[i]['__rowNum__'];
                console.log(js[i])
                for (let j = 0; j < data.length; j++) {
                console.log(data[j])
                    if(js[i].user_name == data[j].user_name && js[i].account == data[j].account){
                        console.log(data[j].uid)
                        obja[i].uid = data[j].uid
                    }
                }
            }
            console.log(obja)
            
            for (let k = 0; k < obja.length; k++) {
                uid = obja[k].uid=='0'?'无效':obja[k].uid
                if(uid == "无效"){
                    $('.im_table')[0].innerHTML+=`
            <tr>
                        <td>`+obja[k].user_name+`</td>
                        <td>`+obja[k].account+`</td>
                        <td>`+obja[k].project+`</td>
                        <td>`+obja[k].class+`</td>
                        <td>`+obja[k].time+`</td>
                        <td>`+uid+`</td>
                    </tr>
            `
                }
            }
            for (let k = 0; k < obja.length; k++) {
                uid = obja[k].uid=='0'?'无效':obja[k].uid
                if(uid != "无效"){
                    $('.im_table')[0].innerHTML+=`
            <tr>
                        <td>`+obja[k].user_name+`</td>
                        <td>`+obja[k].account+`</td>
                        <td>`+obja[k].project+`</td>
                        <td>`+obja[k].class+`</td>
                        <td>`+obja[k].time+`</td>
                        <td>`+uid+`</td>
                    </tr>
            `
                }
            }
            };
            if(rABS) {
                reader.readAsArrayBuffer(f);
            } else {
                reader.readAsBinaryString(f);
            }
            console.log($(obj))
            $(obj).val('')
            $('.im_table')[0].innerHTML = ''
        }
        
        $('.revisewen').click(function(){
            objaa=JSON.stringify(obja);
            str = '"uid":"0"'
            console.log(objaa,obja)
            $.ajax({
                url:'',
                type:'get',
                data:{obja},
                success:function(){
                    
                },
                error:function(){

                }
            })
        })
        function fixdata(data) { //文件流转BinaryString
            var o = "",
                l = 0,
                w = 10240;
            for(; l < data.byteLength / w; ++l) o += String.fromCharCode.apply(null, new Uint8Array(data.slice(l * w, l * w + w)));
            o += String.fromCharCode.apply(null, new Uint8Array(data.slice(l * w)));
            return o;
        }

    </script>
   <script type="text/javascript">
var user = [{
    uid:'13',
    user_name:'江山',
},{
    uid:'12',
    user_name:'江山1',
},{
    uid:'14',
    user_name:'江山2',
},{
    uid:'15',
    user_name:'江山3',
}]
var group = ["基金一组","基金二组","基金三组","基金四组"];
var sector = ["基金一部","基金二部","基金三部","基金四部"];
var army = ["基金一军团","基金二军团","基金三军团","基金四军团"];
var project = ["基金一项目","基金二项目","基金三项目","基金四项目"];
$('select[name = polling-search]').change(function(){
    switch ($(this).val()) {
        case 'user':
            $('select[name=polling-account]')[0].innerHTML = ""
            for (let i = 0; i < user.length; i++) {
                $('select[name=polling-account]')[0].innerHTML += `<option value=`+user[i].uid+`>`+user[i].user_name+`</option>`
            }
            break;
        case 'group':
        $('select[name=polling-account]')[0].innerHTML = ""
            for (let i = 0; i < group.length; i++) {
                $('select[name=polling-account]')[0].innerHTML += `<option value=`+group[i]+`>`+group[i]+`</option>`
            }
            break;
        case 'sector':
        $('select[name=polling-account]')[0].innerHTML = ""
        for (let i = 0; i < sector.length; i++) {
                $('select[name=polling-account]')[0].innerHTML += `<option value=`+sector[i]+`>`+sector[i]+`</option>`
            }
            break;
        case 'army':
        $('select[name=polling-account]')[0].innerHTML = ""
        for (let i = 0; i < army.length; i++) {
                $('select[name=polling-account]')[0].innerHTML += `<option value=`+army[i]+`>`+army[i]+`</option>`
            }
            break;
        case 'project':
        $('select[name=polling-account]')[0].innerHTML = ""
        for (let i = 0; i < project.length; i++) {
                $('select[name=polling-account]')[0].innerHTML += `<option value=`+project[i]+`>`+project[i]+`</option>`
            }
            break;
        default:
            break;
    }
    
     objopt5 = optnme($('select[name=polling-account]'))
})
var params = "";
    // $(function(){
    // 		$(function () {
	//             var p = $('#datagrid2').datagrid('getPager');
	//             $(p).pagination({
	//                 beforePageText: '第',//页数文本框前显示的汉字  
	//                 afterPageText: '页    共 {pages} 页',
	//                 displayMsg: '当前: 第 {from}~{to} 条   共 {total} 条',
	//             });
	//        });
    // 	})
    $('.promptx1').click(function(){
            $('.modelprompt1')[0].style.display = "none";
        })
    function optnme(q){
            var arr1 = [];
            var arr2 = [];
            var objopt = {}
            for (let i = 0; i < q[0].length; i++) {
                arr1.push( q[0][i].value);
                arr2.push(q[0][i].innerHTML);
                
            }
           for (var j = 0; j < arr1.length; j++) {
               objopt[arr1[j]] = arr2[j]
               
           }
           return objopt
        }
    // var objopt5 = optnme($('select[name=polling-account]'))
    //     function huhu(){
    //         console.log(objopt5)
    //         $('select[name=polling-account]')[0].innerHTML = ""
    //         for(var k in objopt5){
    //             if(objopt5[k].indexOf($('input[name=polling-name]').val())> -1){
    //                 $('select[name=polling-account]')[0].innerHTML += "<select name='polling-account'>"
    //                 +"<option value="+k+">"+objopt5[k]+"</option>"+"</select>"
    //             }
    //         }
    //     }
    //     $('input[name=polling-name]').on('keyup',function(){
    //         huhu()
    //     });
        var objopt6 = optnme($('select[name=group_name]'))
        function hehe(){
            $('select[name=group_name]')[0].innerHTML = ""
            for(var k in objopt6){
                if(objopt6[k].indexOf($('input[class=search_input]').val())> -1){
                    $('select[name=group_name]')[0].innerHTML += "<select name='group_name'>"
                    +"<option value="+k+">"+objopt6[k]+"</option>"+"</select>"
                }
            }
        }
        $('input[class=search_input]').on('keyup',function(){
            hehe()
        });
    $('.polling-headerp').click(function(){
        if($(this)[0].style.backgroundImage == 'url("img/down.svg")'){
            console.log(1)
             $(this)[0].style.backgroundImage = 'url("img/up.svg")';
             $('#polling-header-body')[0].style.display = "none"
        }else{
            $(this)[0].style.backgroundImage = 'url("img/down.svg")'
            $('#polling-header-body')[0].style.display = "block"
        }
    })
    $('.polling-allotp').click(function(){
        if($(this)[0].style.backgroundImage == 'url("img/down.svg")'){
            console.log(1)
             $(this)[0].style.backgroundImage = 'url("img/up.svg")';
             $('#polling-allot-body')[0].style.display = "none"
        }else{
            $(this)[0].style.backgroundImage = 'url("img/down.svg")'
            $('#polling-allot-body')[0].style.display = "block"
        }
    })
    $('.reset').click(function(){
        $("#seaform").find('input[type=text],select,input[type=hidden]').each(function() {
         $(this).val('');
     });
    })   
       var thisApp = {
        init: function () {
            $("#datagrid2").edatagrid({
                collapsible:true,
                rownumbers: true,
                singleSelect: false,
                pagination: true,
                url:'datagrid_data3.json',
                method:'get',
                remoteSort: false,
                checkOnSelect:true,
                selectOnCheck:true,
                showFooter:true,
                saveUrl: 'http://www.baidu.com',        //新建,都是eadatagrid封装好的,把链接填好就行,点击之后会自动发送json数据包
                updateUrl: 'http://www.baidu.com',      //保存
                pageSize: 10,
                pageList: [10, 50, 100],
                toolbar: [
                {
                    text: '导出',
                        iconCls: 'icon-save',
                        handler: function () {
                            // $(this).click(function(){
                                var jsondata = '';
                                $.ajax({
                                    url:'datagrid_data3.json',
                                    type:'get',
                                    data:params,
                                    // dataType:'json',
                                    success:function(data){
                                     jsondata = data;
                                     console.log(data)
                                var arr1 = [];
                                var json = []
                                for(var i=0;i<jsondata.length;i++){
                                    json[i]={};
                                    json[i]['date_time']= ' '+jsondata[i].date_time;
                                    json[i]['user_name']= jsondata[i].user_name;
                                    json[i]['group']= jsondata[i].group;
                                    json[i]['grade']= jsondata[i].grade;
                                    json[i]['max_num']= jsondata[i].max_num;
                                    json[i]['rate']= jsondata[i].rate;
                                    json[i]['alloc_num']= jsondata[i].alloc_num;
                                    json[i]['work_type']= jsondata[i].work_type;
                                }
                                // json[0].visit = data[0].visit;
                                
                                var data = JSON.stringify(json);
                                console.log(data)
                                for (var i = 0; i < $('th').length; i++) {
                                    arr1.push($('th')[i].innerHTML)
                                }
                                if (data == '')return;
                                // JSONToCSVConvertor(data, "Download", true,arr1);
                                }})
                                // })
                        }
                    },
                {
                        text: '保存',
                        iconCls: 'icon-save',
                        handler: function () {
                            $('#datagrid2').data('isSave', true).edatagrid('saveRow');
                        }
                    },
                    {
                        text: '上传班表',
                        iconCls: 'icon-save',
                        handler: function () {
                            $('.model-work-order').css('display','block')
                            $('.im_table')[0].innerHTML=` <tr>
                        <td>姓名</td>
                        <td>账号</td>
                        <td>项目</td>
                        <td>班次</td>
                        <td>时间</td>
                        <td>uid</td>
                    </tr>`
                            // $('#datagrid2').data('isSave', true).edatagrid('saveRow');
                        }
                    }],
                    onSortColum: function (sort,order) {  //其中sort代表排序列字段名称；order:排序列的顺序（ASC或DESC）
                    　　　$('#datagrid2').datagrid('reload', {
                    　　　sort: sort,
                    　　　order: order
                    　　});
                    },
                    onLoadSuccess: function(data){//加载完毕后获取所有的checkbox遍历

                    },
                    onClickRow : function(rowIndex, rowData) {

                    },
                    onDblClickRow:function(){
                        console.log(1)
                    }
            })
        }
       }
       $(function(){
        thisApp.init();
        var dg=$('#datagrid2').datagrid({singleSelect:false});
        dg.datagrid('enableFilter', [{}]);
        var p = $('#datagrid2').datagrid('getPager');
								        $(p).pagination({
								            beforePageText: '第',//页数文本框前显示的汉字  
								            afterPageText: '页    共 {pages} 页',
								            displayMsg: '当前: 第 {from}~{to} 条   共 {total} 条',
								        });  
        $(".seasearch").linkbutton({ iconCls: 'icon-search', plain: true }).click(function () {
            // $('#polling-header-footer')[0].style.display = "block"
            thisApp.init();
            params=form2Json("seaform");
        //     $('.polling-headerp')[0].style.backgroundImage = 'url("{{asset("img/up.svg")}}")';
        //  $('#polling-header-body')[0].style.display = "none";
         var dg = $('#datagrid2').datagrid({queryParams: form2Json("seaform"),singleSelect:false,url:'datagrid_data3.json'});
        dg.datagrid('enableFilter', [{
                field:'mobile',
                type:'text'
            },{
                field:'project',
                type:'text'
            },{
                field:'first_name',
                type:'text'
            },{
                field:'last_name',
                type:'text'
            },{
                field:'in_time',
                type:'text'
            },{
                field:'last_consult_time',
                type:'text'
            },{
                field:'visit_times',
                type:'text'
            },{
                field:'give_up_times',
                type:'text'
            },{
                field:'sign_times',
                type:'text'
            },{
                field:'book_reason',
                type:'text'
            }]);
         var p = $('#datagrid2').datagrid('getPager');
	        $(p).pagination({
	            beforePageText: '第',//页数文本框前显示的汉字  
	            afterPageText: '页    共 {pages} 页',
	            displayMsg: '当前: 第 {from}~{to} 条   共 {total} 条',
	        });            
        });
        $('.polling-allot').click(function(){
            var get2 = $("#datagrid2").datagrid("getSelections");
                            var arr5 = []
                            for(let i=0;i<get2.length;i++)

                            {
                                    arr5.push(get2[i].did) ;
                            }
                            console.log(arr5)
            if($('select[name=polling-account]').val()!=""){
                $.ajax({
                    url:'{{Url("admin/publicToMyData")}}',
                    type:'post',
                    data:{did:arr5,
                    data_switch:$('select[name = data_switch]').val(),
                    limit_time1:$('input[name=limit_time1]').val(),
                    limit_time2:$('input[name=limit_time2]').val(),
                    allotname:$('select[name=polling-account]').val(),_token:"{{csrf_token()}}"},
                    dataType:'json',
                    success:function(data){
                    	console.log(data)
							        if(data.success == true){
							        	$('.modelprompt1')[0].style.display="block";
							            $('.promptp1')[0].innerHTML = "成功"+data.successNum+"条 "+ ' 失败'+data.failNum+'条';
							        }else if(data.success == false){
							            $('.modelprompt1')[0].style.display="block";
							            $('.promptp1')[0].innerHTML = "该时段不能分配";	            
							        }else{
							            $('.modelprompt1')[0].style.display="block";
							            $('.promptp1')[0].innerHTML = "未知错误";	            
							        }
							    },
							    error:function(){
							        $('.modelprompt1')[0].style.display="block";
							            $('.promptp1')[0].innerHTML = "服务器错误";	            
							    	}
                })
            }else{
                $('.modelprompt1')[0].style.display="block";
							            $('.promptp1')[0].innerHTML = "请选择姓名";	            
							    	}
            
        })
        $('.panel-title').append(`
                <span style="margin-left:2rem;color:red">基金：112</span>
                <span style="margin-left:2rem;color:red">消防：112</span>
            `)
    // });
    })
    function form2Json(id) {

        var arr = $("#" + id).serializeArray()
        var jsonStr = "";

        jsonStr += '{';
        for (var i = 0; i < arr.length; i++) {
            jsonStr += '"' + arr[i].name + '":"' + arr[i].value + '",'
        }
        jsonStr = jsonStr.substring(0, (jsonStr.length - 1));
        jsonStr += '}'

        var json = JSON.parse(jsonStr)
        return json
    }
    </script>
</html>