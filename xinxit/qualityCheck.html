<!DOCTYPE html>
<html lang="en">
    <head>
        <title>质检表</title>
        <!-- Bootstrap -->
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
     
        <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
        <link href="bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet" media="screen"> 
        <link href="vendors/easypiechart/jquery.easy-pie-chart.css" rel="stylesheet" media="screen">
        <link href="css/styles.css" rel="stylesheet" media="screen">
           <link rel="stylesheet" href="css/index.css">
           <link rel="stylesheet" href="css/polling.css">
       <script src="vendors/modernizr-2.6.2-respond-1.1.0.min.js"></script>
        <link rel="stylesheet" type="text/css" href="themes/default/easyui.css">
        <link rel="stylesheet" type="text/css" href="themes/icon.css">
        <script src="http://libs.baidu.com/jquery/2.1.4/jquery.min.js"></script>
        <script type="text/javascript" src="https://www.jeasyui.com/easyui/jquery.easyui.min.js"></script>
        <script type="text/javascript" src="https://www.jeasyui.com/easyui/datagrid-filter.js"></script>
        <script type="text/javascript" src="https://www.jeasyui.com/easyui/datagrid-cellediting.js"></script>
        <link rel="stylesheet" href="css/table.css">
        <script src="My97DatePicker/My97DatePicker/WdatePicker.js"></script>
        <style>
            .hidd>div,.hidd1>div,.hidd2>div,.hidd3>div,.hidd4>div,.hidd5>div,.hidd6>div,.hidd7>div,.hidd8>div,.hidd9>div,.hidd10>div,.hidd11>div,.hidd12>div{
                float: left;
                width: 25%;
                text-align: center
            }
            .hidd3>div,.hidd4>div,.hidd6>div,.hidd7>div,.hidd8>div,.hidd9>div,.hidd10>div,.hidd11>div,.hidd12>div{
                width: 33%;
            }
            .hidd5>div{
                width: 50%;
            }
            #seaform>div>div>input{
                width: 60%;
                height: 20px;
            }
            #seaform>div>div{
                margin: 0;
            }
            #seaform>div>div>select {
                width: 62%;
                height: 30px;
            }
            #seaform>div>div>span{
                display: inline-block;
                width: 30%;
            }
            #polling-header-body{
                padding: 0;
            }
            .seaformp1,.seaformp2,.seaformp3{
                background-repeat: no-repeat;
                background-position-x: 99%;
                background-position-y: 50%;
            }
            #polling-header-top{
                height: 30px;
            }
            #polling-header-top>p {
                line-height: 30px;
            }
        </style>
        <script>
       
        </script>
    </head>
    
    <body>
        <div class="container-fluid">
            <div class="row-fluid">
                <!-- block -->
                <div class="block">
                    <div class="span12" id="polling-header">
                        <div class=" span10 " id="polling-header-top">
                            <p class="polling-headerp" style="background-image: url('img/down.svg');"><span></span>查询条件</p>
                        </div>
                        <div class=" span10 " id="polling-header-body">
                            <form style="position:relative" name="seaform" id ="seaform">
                                <div style="width:100%;height:30px;position:relative;background:rgb(248,248,248);border-top:1px solid rgb(219,219,219)">
                                    <span style="display: inline-block;width: 16px;height: 16px;position: absolute;top: 50%;margin-top: -8px;left: 10px;background: url(img/search.svg) no-repeat;background-size: 100% 100%;"></span>
                                    <p class="seaformp1" style="background-image: url('img/down.svg');    line-height: 30px;position: relative;padding-left: 30px;">时间</p>
                                </div>
                                <div class="didi1" style="margin-top:10px;display:none">
                                    <div class="span4" style="position:relative;" data-ig="time_start">
								        <span>起始时间：</span><input class="" type="text"  name="start_time"  onClick="WdatePicker({el:this,dateFmt:'yyyy-MM-dd 00:00:00'})"  placeholder="日期" autocomplete="off">
								        
								    </div>
								    <div class="span4" style="position:relative;" data-ig="time_end">
								        <span>截止时间：</span><input class="" type="text"  name="end_time"  onClick="WdatePicker({el:this,dateFmt:'yyyy-MM-dd 23:59:59'})" placeholder="日期" autocomplete="off">
								    </div>
								    <div class="span4" style="position:relative;" data-ig="time_type">
								        <span>快捷搜索：</span><select name="time_type" class="mwd" id="">
								            <option value="">自定义</option>    
								            <option value="today">今天</option>    
								            <option value="yesterday">昨天</option>    
								            <option value="thisWeek">本周</option>    
								            <option value="lastWeek">上周</option>    
								            <option value="thisMonth">本月</option>    
								            <option value="lastMonth">上月</option>    
								        </select>
								    </div>
                                    <div style="clear:both"></div>
                                </div>
                                <div style="width:100%;height:30px;position:relative;background:rgb(248,248,248);border-top:1px solid rgb(219,219,219)">
                                    <span style="display: inline-block;width: 16px;height: 16px;position: absolute;top: 50%;margin-top: -8px;left: 10px;background: url(img/search.svg) no-repeat;background-size: 100% 100%;"></span>
                                    <p class="seaformp2" style="background-image: url('img/down.svg');    line-height: 30px;position: relative;padding-left: 30px;">归属</p>
                                </div>
                                <div class="didi2" style="margin-top:10px;display:none">
                                    <div class="span4" style="position:relative;">
								        <span>职能：</span><select name="saleType" id=""> 
                                            <option value="">请选择</option>    
								            <option value="preSale">前端</option>    
								            <option value="reSale">后端</option>  
								        </select>
                                    </div>
                                    <div class="span4" style="position:relative;" >
								        <span>单位：</span><select name="scaleType" id="">
								            <option value="">请先选择职能</option>    
								        </select>
								    </div>
                                    <div class="span4" style="position:relative;" data-ig="psg">
                                        <span>信息：</span><input class="" type="text"  name="psg"  placeholder="属员" style="">
                                        <div class="hidd5" style="display:none;width:60%;position:absolute;top:30px;z-index:999;left:30%;background:white;border:1px solid rgb(219,219,219);border-radius:5px;padding:4px 6px">
                                                
                                        </div>
                                    </div>
                                    <div style="clear:both"></div>
                                </div>
                                <input type="button" class="reset" value="重置" style="margin-right:30px"></input>
                                <input type="button" id="seasearch"  class="seasearch" value="查询"></input>
                                <div style="clear:both"></div>
                            </form>
                        </div>
                        <div class=" span10 " id="polling-header-footer">
                                <div class="block-content collapse in" >
                                        <div class="span12">
                                              <div style="overflow:auto">
                                                    <table id="datagrid5" title="质检表" style="width:100%;height:400px"
                                                    data-options="rownumbers:true,singleSelect:true,pagination:true,pageSize:10,pagelist:[10,20,30]">
                                               
                                                        <!-- <th data-options="field:'ck',checkbox:true"></th> -->
                                                        <!-- <thead data-options="frozen:true">
                                                            <tr>
                                                                <th data-options="field:'info',width:80,align:'center'" >日期</th>
                                                                <th data-options="field:'belong',width:80,align:'center'" >归属</th>
                                                            </tr>
                                                        </thead> -->
                                                         <thead>
                                                    <tr class="content">
                                                        <th data-options="field:'datetime',sortable:true,
                                                        sorter:function (a,b) {
                                                            return(Number(a)>Number(b))?1:-1
                                                        },width:350,align:'center'">时间</th>
                                                        <th data-options="field:'username',sortable:true,
                                                        sorter:function (a,b) {
                                                            return(Number(a)>Number(b))?1:-1
                                                        },width:350,align:'center'">姓名</th>
                                                        <th data-options="field:'num',sortable:true,
                                                        sorter:function (a,b) {
                                                            return(Number(a)>Number(b))?1:-1
                                                        },width:350,align:'center'">修改次数</th>

                                                        <!-- <th data-options="field:'did',width:90,align:'center',hidden:true">did</th> -->
                                                        <th data-options="field:'uid',width:90,align:'center'">uid</th>
                                                        
                                                    </tr>
                                                    
                                                </thead>
                                            </table>
                                        </div>
                                        </div>
                                    </div>
                        </div>
                                
                    </div>
                </div>
            </div>
        </div>
            
    </div>
    </body>
    <!-- <script src="bootstrap/js/bootstrap.min.js"></script> -->
    <script src="js/export.js"></script>
    <script type="text/javascript">
    
    var params = "";
    $('.datagrid-header span:nth-of-type(1)').attr('data-title','jiangshan')
    $('.polling-headerp').click(function(){
        if($(this)[0].style.backgroundImage != 'url("img/up.svg")'){
             $(this)[0].style.backgroundImage = 'url("img/up.svg")';
             $('#polling-header-body')[0].style.display = "none"
        }else{
            $(this)[0].style.backgroundImage = 'url("img/down.svg")'
            $('#polling-header-body')[0].style.display = "block"
        }
    })

    //伸开展开
    $('.seaformp2').click(function(){
        if($(this)[0].style.backgroundImage != 'url("img/up.svg")'){
             $(this)[0].style.backgroundImage = 'url("img/up.svg")';
             $('.didi2')[0].style.display = "block"
        }else{
            $(this)[0].style.backgroundImage = 'url("img/down.svg")'
            $('.didi2')[0].style.display = "none"
        }
    })
    $('.seaformp3').click(function(){
        if($(this)[0].style.backgroundImage != 'url("img/up.svg")'){
             $(this)[0].style.backgroundImage = 'url("img/up.svg")';
             $('.didi3')[0].style.display = "block"
        }else{
            $(this)[0].style.backgroundImage = 'url("img/down.svg")'
            $('.didi3')[0].style.display = "none"
        }
    })
    $('.seaformp1').click(function(){
        if($(this)[0].style.backgroundImage != 'url("img/up.svg")'){
             $(this)[0].style.backgroundImage = 'url("img/up.svg")';
             $('.didi1')[0].style.display = "block"
        }else{
            $(this)[0].style.backgroundImage = 'url("img/down.svg")'
            $('.didi1')[0].style.display = "none"
        }
    })

    //重置
    $('.reset').click(function(){
        $("#seaform").find('input[type=text],select').each(function() {
     });
     $('input[type=checkbox]').each(function(){
        $(this)[0].checked = false
     })
    })   

    //表
       var thisApp = {
        init: function () {
            $("#datagrid5").datagrid({
                collapsible:true,
                rownumbers: true,
                singleSelect: true,
                pagination: true,
                url:'datagrid_data1.json',
                method:'get',
                remoteSort: false,
                checkOnSelect:false,
                selectOnCheck:true,
                showFooter:true,
                pageSize: 10,
                pageList: [10, 50, 100],
                queryParams: form2Json("seaform"),
                toolbar: [
                     {
                        text: '导出',
                        iconCls: 'icon-save',
                        handler: function () {
                            // $(this).click(function(){
                                var jsondata = '';
                                $.ajax({
                                    url:'datagrid_data1.json',
                                    type:'get',
                                    data:params,
                                    // dataType:'json',
                                    success:function(data){
                                     jsondata = data;
                                     console.log(data)
                                var arr1 = [];
                                var json = []
                                for(var i=0;i<jsondata.length;i++){
                                    json[i]={};
                                    json[i]['datetime']= ' '+jsondata[i].datetime;
                                    json[i]['username']= jsondata[i].username;
                                    json[i]['num']= jsondata[i].num;
                                }
                                // json[0].visit = data[0].visit;
                                
                                var data = JSON.stringify(json);
                                console.log(data)
                                for (var i = 0; i < $('th').length; i++) {
                                    arr1.push($('th')[i].innerHTML)
                                }
                                if (data == '')return;
                                // JSONToCSVConvertor(data, "Download", true,arr1);
                                }})
                                // })
                        }
                    }],
                    onSortColum: function (sort,order) { 
                    },
                    onLoadSuccess: function(data){
                        console.log($('#datagrid5').datagrid('getData'))
                    },
//                     onSortColum: function (sort,order) {  //其中sort代表排序列字段名称；order:排序列的顺序（ASC或DESC）
// 　　　$('#dg').datagrid('reload', {
// 　　　sortName: 'uid',
// 　　　sortOrder:'desc',
// 　　});
// },
                    onClickRow : function(rowIndex, rowData) {
                    },
                    onDblClickRow:function(){
                    }
            })
        }
       }
       
    function form2Json(id) {

        var arr = $("#" + id).serializeArray()
        var jsonStr = "";

        jsonStr += '{';
        for (var i = 0; i < arr.length; i++) {
            jsonStr += '"' + arr[i].name + '":"' + arr[i].value + '",'
        }
        jsonStr = jsonStr.substring(0, (jsonStr.length - 1));
        jsonStr += '}'

        var json = JSON.parse(jsonStr)
        return json
    }


    // $('select[class=mwd]').on('change',function(){
    //     chan();
    // })
    function getNowFormatDate(date) {
    var seperator1 = "-";
    var seperator2 = ":";
    var month = date.getMonth() + 1;
    var strDate = date.getDate();
    var hour = date.getHours();
    var minute = date.getMinutes();
    var second = date.getSeconds();
    if (month >= 1 && month <= 9) {
        month = "0" + month;
    }
    if (strDate >= 0 && strDate <= 9) {
        strDate = "0" + strDate;
    }
    if (hour >= 0 && hour <= 9) {
        hour = "0" + hour;
    }
    if (minute >= 0 && minute <= 9) {
        minute = "0" + minute;
    }
    if (second >= 0 && second <= 9) {
        second = "0" + second;
    }
    var currentdate = date.getFullYear() + seperator1 + month + seperator1 + strDate
            + " " + hour + seperator2 + minute
            + seperator2 + second;
    return currentdate;
    }
    function chanw(){
        var oneday = 1000 * 60 * 60 * 24,today=new Date();
        getday = today.getDay() == 0?7: today.getDay();
        switch ($('select[name=time_type]').val()) {
            case "today":
            $('input[name = start_time]').val(getNowFormatDate(new Date(new Date(new Date().toLocaleDateString()).getTime())));
            $('input[name = end_time]').val(getNowFormatDate(new Date()))
                break;
                case "yesterday":
            $('input[name = start_time]').val(getNowFormatDate(new Date(new Date(new Date().toLocaleDateString()).getTime()-oneday)));
            $('input[name = end_time]').val(getNowFormatDate(new Date(new Date(new Date().toLocaleDateString()).getTime()-1)))
                break;
                case "thisWeek":
            $('input[name = start_time]').val(getNowFormatDate(new Date(new Date().getTime()- oneday * (getday -1))));
            $('input[name = end_time]').val(getNowFormatDate(new Date()))
                break;
                case "lastWeek":
            $('input[name = start_time]').val(getNowFormatDate(new Date(new Date(new Date().toLocaleDateString()).getTime()- oneday * (getday+6))));
            $('input[name = end_time]').val(getNowFormatDate(new Date(new Date(new Date().toLocaleDateString()).getTime()- oneday * (getday-1)-1)));
             break;
                case "thisMonth":
            $('input[name = start_time]').val(getNowFormatDate(new Date(new Date(new Date().toLocaleDateString()).getTime()- oneday * (today.getDate()-1))));
            $('input[name = end_time]').val(getNowFormatDate(new Date()))
                break;
                case "lastMonth":
            $('input[name = start_time]').val(getNowFormatDate(new Date(new Date(new Date(new Date().toLocaleDateString()).getTime() - oneday * today.getDate()) - oneday * (new Date(today - oneday * today.getDate()).getDate() - 1))));
            $('input[name = end_time]').val(getNowFormatDate(new Date(new Date(new Date().toLocaleDateString()).getTime()- oneday * (today.getDate()-1)-1)))
                break;
            default:
                break;
        }
    }
    $('select[name=time_type]').on('change',function(){
        chanw();
    })
    $('select[name = saleType]').on('change',function(){
        if($(this).val() == "preSale"){
            $('select[name = scaleType]').html(`
            <option value="">请选择</option>    
            <option value="project">项目</option>    
								            <option value="sector">部门</option>    
								            <option value="group">小组</option> 
            `)
        }else if($(this).val() == "reSale"){
            $('select[name = scaleType]').html(`
            <option value="">请选择</option>    
            <option value="project">项目</option>    
            `)
        }else{
            $('select[name = scaleType]').html(`
            <option value="">请先选择职能</option>      
            `)
        }
    })
    $('select[name = scaleType]').on('change',function(){
        psg = $(this).val();
        $.ajax({
            url:'',
            type:'get',
            data:{psg:psg},
            // dataType:'json',
            success:function(data){
                $('.hidd5')[0].innerHTML = "";
                data = ['1','2','3','4'];
                for(var k in data){
                            $('.hidd5')[0].innerHTML+=`<div style="text-align:center">
                                <input type="checkbox" name="" id="" style="vertical-align: top;"><span data-uid="`+data[k]+`" style="display: inline;">&nbsp;`+data[k]+`</span>
                            </div>`
                        }
            },
            error:function(){

            }
        })
    })
    //小组
    $(document).click(function(e){
        if($(e.target.parentElement).attr('data-ig') == "psg" || $(e.target.parentElement.parentElement).attr('data-ig') == "psg" || $(e.target.parentElement.parentElement.parentElement).attr('data-ig') == "psg"){
            $('.hidd5')[0].style.display = "block"
        }else{
            var hhh = $('input[name = psg]')[0].value;
            $('.hidd5')[0].style.display = "none";
            $('input[name = psg]').val('');
            $('.hidd5 input[type=checkbox]').each(function(index,el){
                    if(el.checked == true){
                        $('input[name = psg]')[0].value +=','+el.nextElementSibling.innerHTML.split(';')[1]
                    }
            })
            $('input[name = psg]')[0].value = $('input[name = psg]')[0].value.substring(1);
            // var arr = $('input[name = psg]')[0].value.split(',');
            // if( hhh != $('input[name = psg]')[0].value){
            //     $.ajax({
            //         url:'aa.php',
            //         type:'get',
            //         data:{gArr:arr,gType:'2'},
            //         success:function(data){
            //             for(var k in data){
            //                 $('.hidd5')[0].innerHTML+=`<div style="text-align:center">
            //                     <input type="checkbox" name="" id="" style="vertical-align: top;"><span data-uid="`+data[k].uid+`" style="display: inline;">&nbsp;`+data[k].user_name+data[k].group+`</span>
            //                 </div>`
            //             }
            //         },
            //         error:function(){
            //         }
            //     })
            // }
        }
    })


    $(document).click(function(e){
        console.log($(e.target).attr('id'))
        if($(e.target).attr('id') == "seasearch"){
            var dg = $('#datagrid5').datagrid({queryParams: form2Json("seaform"),singleSelect:false});
         params=form2Json("seaform");
         console.log(params)
         dg.datagrid('enableFilter', [{
                field:'datetime',
                type:'text'
            },{
                field:'username',
                type:'text'
            },{
                field:'num',
                type:'text'
            }]);
        var p = $('#datagrid5').datagrid('getPager');
        $(p).pagination({
            beforePageText: '第',//页数文本框前显示的汉字  
            afterPageText: '页    共 {pages} 页',
            displayMsg: '当前: 第 {from}~{to} 条   共 {total} 条',
        });
        }
    })
    $(function(){
        thisApp.init();
        var n = 0;
        console.log($('.datagrid-view2 .datagrid-header td span:after'))
        $('.datagrid-header td span').each(function(index,el){
            if(index > 3){
                $(el).attr('data-title','jsn')
            }
        })
        var dg=$('#datagrid5').datagrid({singleSelect:true});
        
        dg.datagrid('enableFilter', [{}]);
        var p = $('#datagrid5').datagrid('getPager');
        $(p).pagination({
            beforePageText: '第',//页数文本框前显示的汉字  
            afterPageText: '页    共 {pages} 页',
            displayMsg: '当前: 第 {from}~{to} 条   共 {total} 条',
        });
        $(".seasearch").linkbutton({ iconCls: 'icon-search', plain: true }).click(function () {
        //     $('.polling-headerp')[0].style.backgroundImage = 'url("img/up.svg")';
        //  $('#polling-header-body')[0].style.display = "none";
         
        });
    // });
    })
    </script>
</html>