<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>机会列表</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/index.css">
    <link rel="stylesheet" type="text/css" href="themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="themes/icon.css">
    <script type="text/javascript" src="https://www.jeasyui.com/easyui/jquery.min.js"></script>
    <script type="text/javascript" src="https://www.jeasyui.com/easyui/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="https://www.jeasyui.com/easyui/datagrid-filter.js"></script>
    <script type="text/javascript" src="https://www.jeasyui.com/easyui/datagrid-cellediting.js"></script>
    <script type="text/javascript" src="https://www.jeasyui.com/easyui/jquery.edatagrid.js"></script>
    <link rel="stylesheet" href="css/tabl e.css">
    <script src="My97DatePicker/My97DatePicker/WdatePicker.js"></script>
    
</head>
<body>  
        <div class="modelchance" style="display:block">
                <div class="modelchancer">
                    <div class="modelchance-head">
                        <p style="color:#42b983">全部数据</p>
                    </div>
                    <div class="chancesearch" style="width:95.8%;border:1px solid rgb(239,239,239);background:-webkit-linear-gradient(top,white 0,rgb(239, 239, 239) 100%)">
                            <p class="chancesearchp" style="margin-left:20px;background-image: url('img/down.svg');">查询条件</p>
                        </div>
                    <form class="modelchance-body" name="searchform" id ="searchform">
                        <div>
                            <span>手机号：</span>
                            <input type="text" name="chancelistphone" style="width:70%">
                        </div>
                        <div>
                            <span>归属：</span>
                            <select name="belong_to" id="">
                                <option value="">请选择</option>
                            </select>
                        </div>
                        <div>
                            <span>项目：</span>
                            <select name="chanceproject" id="" disabled="disabled">
                                <!-- <option value="">请选择项目</option> -->
                                <option value="1">基金</option>
                                <option value="2">消防</option>
                            </select>
                        </div>
                        <div>
                            <span>录入时间：</span>
                            <input class="Wdate" type="text" onClick="WdatePicker({el:this,dateFmt:'yyyy-MM-dd HH:mm:ss'})" name="in_time1" placeholder="日期">
                            <span style="width:10%;text-align:center">至</span>
                            <input class="Wdate" type="text" onClick="WdatePicker({el:this,dateFmt:'yyyy-MM-dd HH:mm:ss'})" name="in_time2" placeholder="日期">
                        </div>
                        <div>
                            <span>报名时间：</span>
                            <input class="Wdate" type="text" onClick="WdatePicker({el:this,dateFmt:'yyyy-MM-dd HH:mm:ss'})" name="sign_time1" placeholder="日期">
                            <span style="width:10%;text-align:center">至</span>
                            <input class="Wdate" type="text" onClick="WdatePicker({el:this,dateFmt:'yyyy-MM-dd HH:mm:ss'})" name="sign_time2" placeholder="日期">
                        </div>
                        <div>
                            <span>最后咨询：</span>
                            <input class="Wdate" type="text" onClick="WdatePicker({el:this,dateFmt:'yyyy-MM-dd HH:mm:ss'})" name="last_time1"  placeholder="日期">
                            <span style="width:10%;text-align:center">至</span>
                            <input class="Wdate" type="text" onClick="WdatePicker({el:this,dateFmt:'yyyy-MM-dd HH:mm:ss'})" name="last_time2" placeholder="日期">
                        </div>
                        <div>
                            <span>最后跟访人：</span>
                            <select name="lastVisitor" id="">
                                <option value="">请选择</option>
                            </select>
                        </div>
                        <!-- <div>
                            <span>类型：</span>
                            <select name="chancesector" id="">
                                <option value="">请选择类型</option>
                                <option value="3">基金</option>
                                <option value="4">消防</option>
                            </select>
                        </div> -->
                        <div>
                            <input type="button" class="chancebtn" id="chancere" style="margin-right:30px" value="重置">
                            <input type="button" class="chancebtn" id="submit_search"  value="查询">
                        </div>
                    </form>
                    <div style="width:96%;margin-left:2%">
                        <table id="datagrid1" title="机会列表" style="width:100%"  
                               >
                            <thead>
                                <tr class="content">
                                    <th data-options="field:'ck',checkbox:true,hidden:true" class="8777"></th>
                                    <th data-options="field:'in_time',width:160,align:'center'">录入时间</th>
                                    
                                    <th data-options="field:'chancelistphone',width:120,align:'center'">手机号</th>
                                    <th data-options="field:'chanceproject',width:80,align:'center'">项目</th>
                                    <th data-options="field:'belong_to',width:80,align:'center'">归属</th>
                                    <th data-options="field:'uid',width:80,align:'center',hidden:true">uid</th>
                                    <th data-options="field:'chat_record',width:80,align:'center'">跟单记录</th>
                                    <th data-options="field:'sign_time',width:160,align:'center',editor:'textbox'">报名时间</th>
                                    <th data-options="field:'last_time',width:160,align:'center',editor:'textbox'">最后咨询时间</th>
                                    <th data-options="field:'last_name',width:80,align:'center',editor:'textbox'">最后跟访人</th> 
                                    <th data-options="field:'sign_times',width:80,align:'center',editor:'textbox'">报名次数</th> 
                                     
                                    <th data-options="field:'did',width:80,align:'center'">did</th>
                                </tr>
                                
                            </thead>
                        </table>
                    </div>
                    
                </div>
              </div>
</body>
<script type="text/javascript">    
    $('.chancesearchp').click(function(){
        if($(this)[0].style.backgroundImage == 'url("img/down.svg")'){
            console.log(1)
             $(this)[0].style.backgroundImage = 'url("img/up.svg")';
             $('#searchform')[0].style.display = "none"
        }else{
            $(this)[0].style.backgroundImage = 'url("img/down.svg")'
            $('#searchform')[0].style.display = "block"
        }
    })
    $('#chancere').click(function(){
        $("#searchform").find('input[type=text],select,input[type=hidden]').each(function() {
         $(this).val('');
     });
    })         
    var thisApp = {
        init: function () {
            var Url;
            console.log(location.href.split('?')[1])
            if(location.href.split('?')[1]==undefined){
                Url = 'www.baidu.com'
            }else{
                Url = 'datagrid_data1.json?'+location.href.split('?')[1]
            }
            $("#datagrid1").datagrid({
                rownumbers: true,
                singleSelect: true,
                pagination: true,
                //这是数据加载的地址,返回对应的json数据包就行,json包格式例子,见下4
                pageSize: 10,
                pageList: [10, 50, 100],
                checkOnSelect:false,
                selectOnCheck:true,
                url:Url,
                method:'get',
                queryParams: form2Json("searchform"),　
                
                    onLoadSuccess: function(data,currentRowIndex){//加载完毕后获取所有的checkbox遍历
                        console.log(currentRowIndex)
                        // if (data.rows.length > 0) {
                        //     //循环判断操作为新增的不能选择
                        //     for (var j = 0; j < data.rows.length; j++) {
                        //         //根据isFinanceExamine让某些行不可选
                        //         if (data.rows[j].did == "") {
                        //             console.log(data.rows[j].did)
                        //             $("input[type='checkbox']")[j + 1].disabled = true;
                        //             $("input[type='checkbox']")[j + 1].checked = false;
                        //         }
                        //     }
                        // }
                        if (data.rows.length > 0) {
                            $(data.rows).each(function(i,element) {
                                console.log($("input[type='checkbox']"))
                                if (data.rows[i].sd == undefined) {
                                        console.log(data.rows[i].did)
                                        $("input[type='checkbox']")[i + 1].disabled = true;
                                        $("input[type='checkbox']")[i + 1].checked = false;
                                    }
                            });
                        }
                        $('.datagrid-header-check').html("<input type='checkbox' id='selectAll'>");
                        $('#selectAll').change(function(){
                            var status = $(this).is(':checked');
                            $("input:checkbox[name = 'ck']").each(function(rowIndex,el){
                                $('#datagrid1').datagrid('unselectRow',rowIndex);
                                $("input:checkbox[name = 'ck']")[rowIndex].checked = false
                                if(!$(this).is(":disabled")){
                                    if(status){
                                        $('#datagrid1').datagrid('checkRow',rowIndex);
                                    }
                                }
                            })
                        })
                        
                    },
                    onClickRow: function (rowIndex, field, value) {
                        if($("input:checkbox[name = 'ck']")[rowIndex].disabled == true){
                            $("input:checkbox[name = 'ck']")[rowIndex].checked = false;
                        }else{
                            
                            if($("input:checkbox[name = 'ck']")[rowIndex].checked == true){
                                $("input:checkbox[name = 'ck']")[rowIndex].checked = false
                            }else{
                                $("input:checkbox[name = 'ck']")[rowIndex].checked = true
                            }
                        }
                        var a= 0;
                        $("input:checkbox[name = 'ck']").each(function(rowIndex,el){
                            
                                if (el.disabled == true) {
                                    $('#datagrid1').datagrid('unselectRow', rowIndex);
                                    a++;
                                }
                            }) 
                            var b=0;
                            for (var i = 0; i < $("input:checkbox[name = 'ck']").length; i++) {
                                if($("input:checkbox[name = 'ck']")[i].checked == true){
                                    b++
                                }
                            }
                            if(a==b){
                                $('#selectAll')[0].checked = true;
                            }else{
                                $('#selectAll')[0].checked = false;
                            }
                        },
                    onDblClickRow:function(rowIndex, field, value){
                        var rows = $('#datagrid1').datagrid('getRows');
                        
                        var row = rows[rowIndex];
                        var uid = row.uid;
                        var did = row.did;
                        if(did != ""){
                            window.location.href = "index.html?did="+did;
                        }
                        
                    }
                })
            }
        }
        $(function(){
            thisApp.init();
            var dg=$('#datagrid1').datagrid({});
            dg.datagrid('enableFilter', [{}]);
            var p = $('#datagrid1').datagrid('getPager');
	            $(p).pagination({
	                beforePageText: '第',//页数文本框前显示的汉字  
	                afterPageText: '页    共 {pages} 页',
	                displayMsg: '当前: 第 {from}~{to} 条   共 {total} 条',
	            });
            $("#submit_search").linkbutton({ iconCls: 'icon-search', plain: true }).click(function () {
            //     $('.chancesearchp')[0].style.backgroundImage = 'url("img/up.svg")';
            //  $('#searchform')[0].style.display = "none";
             var dg = $('#datagrid1').datagrid({queryParams: form2Json("searchform"),url:'datagrid_data1.json',singleSelect:false});
                dg.datagrid('enableFilter',[{
                field:'in_time',
                type:'text'
            },{
                field:'chancelistphone',
                type:'text'
            },{
                field:'chanceproject',
                type:'text'
            },{
                field:'belong_to',
                type:'text'
            },{
                field:'uid',
                type:'text'
            },{
                field:'chat_record',
                type:'text'
            },{
                field:'sign_time',
                type:'text'
            },{
                field:'last_time',
                type:'text'
            },{
                field:'last_name',
                type:'text'
            },{
                field:'sign_times',
                type:'text'
            },{
                field:'did',
                type:'text'
            }]);
                var p = $('#datagrid1').datagrid('getPager');
	            $(p).pagination({
	                beforePageText: '第',//页数文本框前显示的汉字  
	                afterPageText: '页    共 {pages} 页',
	                displayMsg: '当前: 第 {from}~{to} 条   共 {total} 条',
	            });
            });
            
        // });
        })
        function form2Json(id) {
 
            var arr = $("#" + id).serializeArray()
            console.log(arr)
            var jsonStr = "";
 
            jsonStr += '{';
            for (var i = 0; i < arr.length; i++) {
                jsonStr += '"' + arr[i].name + '":"' + arr[i].value + '",'
            }
            jsonStr = jsonStr.substring(0, (jsonStr.length - 1));
            jsonStr += '}'
 
            var json = JSON.parse(jsonStr)
            return json
        }
 
</script>
</html>